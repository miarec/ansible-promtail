server:
  http_listen_port: {{ promtail_http_listen_port }}
  grpc_listen_port: {{ promtail_grpc_listen_port }}

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://{{ loki_url }}:{{ loki_http_listen_port }}/loki/api/v1/push

scrape_configs:

- job_name: systemd-journal

  journal:
{% if ansible_facts['os_family'] == "Debian" %}
    path: /var/log/journal
{% else %}
    path: /run/log/journal
{% endif %}
    labels:
      job: systemd-journal
      {% for k,v in promtail_custom_labels %}
      {{ k }}: {{ v }}
      {% endfor %}

  relabel_configs:
    - source_labels: ['__journal__systemd_unit']
      target_label: unit

{% for dict_item in scrape_jobs %}

- job_name: {{dict_item['job_name']}}
  static_configs:
  - targets:
      - localhost
    labels:
      job: {{dict_item['job_name']}}
      __path__: {{dict_item['path']}}
      {% for k,v in promtail_custom_labels %}
      {{ k }}: {{ v }}
      {% endfor %}

{% endfor %}

